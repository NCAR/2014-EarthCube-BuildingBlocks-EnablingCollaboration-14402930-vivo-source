<#include "elasticsearch-settings.ftl">

${headScripts.add('<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.1/handlebars.min.js"></script>',
              '<script type="text/javascript" src="${urls.base}/js/facetview2/es.js"></script>',
              '<script type="text/javascript" src="${urls.base}/js/facetview2/bootstrap3.facetview.theme.js"></script>',
              '<script type="text/javascript" src="${urls.base}/js/facetview2/jquery.facetview2.js"></script>',
              '<script type="text/javascript" src="${urls.base}/js/js.cookie.js"></script>',
              '<script type="text/javascript">jQuery(function( $ ){$(".close").click(function( e ){e.preventDefault();
               Cookies.set("alert-box-research", "closed", { path: "/" });});});
               jQuery(function( $ ){if( Cookies.get("alert-box-research") === "closed" ){$(".alert").hide();}});
               </script>',
               '<script id="dataset-template" type="text/x-handlebars-template">
       <tr>
           <td>
               <div class="document">
                       <h4>
                           <a class="" href="${url_base}{{uri}}">{{title}}</a>
                       </h4>
                       <div class="doc_info">

                       {{#if dataTypes}}
                       <div class="doc_info_list row"><div class="col-lg-3 col-sm-3 text-muted">Dataset Type:</div>
                       <div class="col-lg-9 col-sm-9">{{#expand dataTypes}} {{#if uri}}<a href="${url_base}{{encodeURL uri}}">{{name}}</a>{{else}}{{name}}{{/if}}{{/expand}}</div></div>
                       {{/if}}

                       {{#if authors}}
                       <div class="doc_info_list row"><div class="col-lg-3 col-sm-3 text-muted">Authors:</div>
                       <div class="col-lg-9 col-sm-9">{{#expand authors}} {{#if uri}}<a href="${url_base}{{encodeURL uri}}">{{name}}</a>{{else}}{{name}}{{/if}}{{/expand}}</div></div>
                       {{/if}}

                       {{#if publicationYear}}
                       <div class="doc_info_list row"><div class="col-lg-3 col-sm-3 text-muted">Publication Year:</div><div class="col-lg-9 col-sm-9"> {{year publicationYear}}</div>
                       {{/if}}

                       {{#if citations}}
                       <div class="doc_info_list row"><div class="col-lg-3 col-sm-3 text-muted">Related documents::</div> <div class="col-lg-9 col-sm-9"> {{#expand citations}}<a href="${url_base}{{uri}}" target="_blank">{{name}}</a>{{/expand}}</div></div>
                       {{/if}}

                       {{#if stations}}
                       <div class="doc_info_list row"><div class="col-lg-3 col-sm-3 text-muted">Related stations::</div> <div class="col-lg-9 col-sm-9"> {{#expand stations}}<a href="${url_base}{{uri}}" target="_blank">{{name}}</a>{{/expand}}</div></div>
                       {{/if}}

                       {{#if homeCountry}}
                       <div class="doc_info_list row"><div class="col-lg-3 col-sm-3 text-muted">Country:</div> <div class="col-lg-9 col-sm-9"> {{homeCountry.name}}</div></div>
                       {{/if}}

                       {{!-- BADGES --}}
                       {{#if doi}}
                       <div style=\'display: inline-block; margin-top:.5em;\'>
                           <div style=\'display: inline;margin-right: .5em;\'><a href="{{doiURL doi}}" target="_blank"><img src="{{doiBadgeURL doi}}" /></a></div>
                       </div>
                       {{/if}}

                     </div>
               </div>
           </td>
         </tr>
   </script>',

   '<script type="text/javascript">

       Handlebars.registerHelper("doiURL", function(doi) {
           return "https://doi.org/"+doi;
       });

       Handlebars.registerHelper("encodeURL", function(url) {
           return encodeURIComponent(url);
       });

       Handlebars.registerHelper("year", function(date) {
           return new Date(date).getUTCFullYear();
       });

       Handlebars.registerHelper("doiBadgeURL", function(doi) {
           var escapedDOI = encodeURIComponent(doi).replace(/-/g, "--");
           return "https://img.shields.io/badge/DOI-" + escapedDOI + "-blue.svg";
       });

       Handlebars.registerHelper("expand", function(items, options) {
           var out = "";
           var j = items.length - 1;
           for(var i = 0; i < items.length; i++) {
               out += options.fn(items[i]);
               if(i < j) {
                   out += "; ";
               }
           }
           return out;
       });

       Handlebars.registerHelper("list", function(items, options) {
           var out = "<ul class=\'list-unstyled\'>";
           for(var i=0, l=items.length; i<l; i++) {
               out = out + "<li>" + options.fn(items[i]) + "</li>";
           }
           return out + "</ul>";
       });

       var source = $("#dataset-template").html();
       var template = Handlebars.compile(source);

   </script>',

              '<script type="text/javascript">
        jQuery(document).ready(function($) {
            $(".facet-view-simple").facetview({
                search_url: "${elasticsearch_base}/dataset/_search",
                page_size: 10,
                page_size_dropdown: true,
                sort: [{"_score" : {"order" : "desc"}},{"publicationYear" : {"order" : "desc"}}],
                sharesave_link: false,
                search_button: true,
                //default_freetext_fuzzify: "*",
                default_facet_operator: "AND",
                default_facet_order: "count",
                default_facet_size: 10,
                search_fields_multi: ["*folded","_all"],
				        pushstate: false,
                csv_export: true,
                facets: [
                  {"field": "dataTypes.name.exact", "display": "Dataset Type", "open" : true, "controls": false},
                  {"field": "publicationYear", "display": "Publication Year", "type" : "date_histogram", "open" : false,"sort":"desc", "size" : 50, "controls": false},
                  {"field": "authors.name.exact", "size": 20, "display": "Author", "controls": false}
                ],
                search_sortby: [
                    {"display":"Relevance","field":["_score","publicationYear"]},
                    {"display":"Title","field":"title.exact"},
                    {"display":"Date","field":"publicationYear"}
                ],
                render_result_record: function(options, record)
                  {
                      return template(record).trim();
                  },
                  selected_filters_in_facet: true,
                                show_filter_field : true,
                                show_filter_logic: true,

                            });
                        });

                    </script>')}

    ${stylesheets.add('<link rel="stylesheet" href="${urls.base}/js/facetview2/css/facetview.css" />',
                      '<link rel="stylesheet" href="${urls.base}/js/facetview2/css/browsers.css" />',
                      '<link rel="stylesheet" href="${urls.base}/js/facetview2/css/style.css" />',
                      ' <style type="text/css">

                      .facet-view-simple{
                          width:100%;
                          height:100%;
                          margin:0 auto 0 auto;
                          font-size: 14px;
                      }

                      .facet-view-simple a {
                          text-decoration: none
                      }

                      .facetview_freetext.span4 {
                         width: 290px;
                         height: 10px;
                      }

                      legend {
                          display: none;
                      }

                      #wrapper-content {
                        // padding: 0px !important;
                        width: 970px !important;

                      }

                      input {
                          -webkit-box-shadow: none;
                          box-shadow: none;
                      }

                      .person-info {
                          display: inline-block;
                          vertical-align: top;
                          // clear: left;
                          margin-left: 0 !important;
                      }

                      .thumbnail {
                          display: inline-block;
                          width: 150px;
                          box-shadow: none;
                          border: none;
                      }

                      .row {
                        //  background-color: #fff !important;
                          margin: 0 !important;
                      }

                      h4 a:link, h4 a:visited{
                        text-decoration: none !important;
                      }

                      .facet-panel {
                        border: 2px solid;
                        border-color: #f3f3f0;
                      }

                      ul#main-nav {
                      width: 970px !important;
                      height: 48px !important;
                      }

                      #unavco-branding {
                        height: 57px !important;
                      }


                  </style>')}

<section id="menupage-intro" role="region">
<h2>${page.title}</h2>
<div style="clear:both"></div>

<div class="alert alert-info fade in">
   <a href="#" class="close" data-dismiss="alert" aria-label="close">&#10006;</a>
<small>${i18n().class_group_description_datasets}</small>
</div>

</section>
<div class="facet-view-simple"></div>
